{"id":"clarigen-2hm","title":"Build ClarityValue function arguments on form submission","description":"Convert form values to ClarityValue types when the tx builder form is submitted. Use the function's ABI to properly encode each argument using parseToCV or direct CV constructors.","design":"On form submit:\n1. Get form values (already have from onSubmit handler)\n2. Iterate through func.args from ABI\n3. For each arg, convert form value to ClarityValue:\n   - Use parseToCV(value, arg.type) from @clarigen/core, OR\n   - Use CV constructors from @stacks/transactions directly\n4. Build array of ClarityValues in order\n5. Return/log the encoded arguments\n6. Eventually use for makeContractCall\n\nHandle all types:\n- Primitives: uintCV, intCV, boolCV, principalCV\n- Buffers: bufferCV (from hex)\n- Strings: stringAsciiCV, stringUtf8CV\n- Optional: someCV(inner) or noneCV()\n- List: listCV(items)\n- Tuple: tupleCV(object)\n- Response: responseOkCV(ok) or responseErrorCV(err)","acceptance_criteria":"- Form submission produces array of ClarityValue objects\n- All Clarity types convert correctly from JS values\n- Nested types (optional, list, tuple) handled recursively\n- Conversion errors are caught and displayed\n- Console logs show properly encoded arguments ready for transaction","status":"closed","priority":1,"issue_type":"feature","assignee":"claude","created_at":"2025-12-17T06:56:03.905431-08:00","updated_at":"2025-12-17T07:47:07.41226-08:00","closed_at":"2025-12-17T07:47:07.41226-08:00","close_reason":"Implemented formValuesToFunctionArgs() and formValueToCV() functions to convert form values to ClarityValue types. Handles all Clarity types including primitives, buffers (hex string to Uint8Array), optionals ({ isNone, value } form structure), lists, tuples, and response types. Integrated into form submission handler with error display. Tested successfully with mainnet token transfer function."}
{"id":"clarigen-l61","title":"Add form-level validation to prevent invalid submission","description":"Implement validation to ensure the tx builder form cannot be submitted unless all required fields are present and valid. Disable submit button when form has errors.","design":"Using TanStack Form's built-in validation:\n- Add validators to each field type that return error messages\n- Use form.state.canSubmit or check form.state.isValid\n- Disable SubscribeButton when form is invalid\n- Show aggregate error state (e.g., \"X fields have errors\")\n- Required fields must have non-empty values","acceptance_criteria":"- Submit button is disabled when form has validation errors\n- All required fields validate as non-empty\n- Form displays validation state clearly\n- Submission is blocked until all fields are valid","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-17T06:56:03.800971-08:00","updated_at":"2025-12-17T06:56:03.800971-08:00"}
{"id":"clarigen-qfp","title":"Add devnet network support and move tx builder data fetching to client-side","description":"Enable 'devnet' network option and convert server-side data loading in tx builder page to client-side fetching. This will allow using localhost-based networks by moving getContractAbi calls and function resolution from the route loader to React components.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-16T21:06:55.715779-08:00","updated_at":"2025-12-16T21:16:08.651676-08:00","closed_at":"2025-12-16T21:16:08.651676-08:00","close_reason":"Moved tx builder route to client-side TanStack Query fetching and enabled devnet network support with localhost API base."}
{"id":"clarigen-qii","title":"Implement response type field component","description":"Add support for the (response ok-type err-type) Clarity type in the tx builder form. This is used by public functions to commit their changes or abort. Create a new ResponseField component that handles both ok and err type branches.","design":"ResponseField should:\n- Display two sections: \"Ok value\" and \"Error value\"\n- Render nested ClarityField for both ok-type and err-type\n- Use form structure like: { ok: value, err: value }\n- Add to clarity-field.tsx dispatcher using isClarityAbiResponse() type checker\n- Follow same pattern as OptionalField for nested field context","acceptance_criteria":"- ResponseField component renders both ok and err branches\n- Nested fields properly inherit field context\n- Values serialize/deserialize correctly in URL state\n- Component integrated into clarity-field.tsx dispatcher","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-17T06:56:03.73719-08:00","updated_at":"2025-12-17T06:56:03.73719-08:00"}
{"id":"clarigen-rch","title":"Add field-level validation for Clarity types","description":"Implement proper validation for each Clarity type field to ensure values conform to type constraints before submission.","design":"Validation rules by type:\n- principal: Use createAddress() from @stacks/transactions, catch errors\n- trait_reference: Same as principal but must contain \".\" for contract\n- uint128: Must be non-negative integer, fit in 128 bits\n- int128: Must be valid signed integer, fit in 128 bits\n- buffer: Must be valid hex, length must not exceed max-len\n- string-ascii: Must be ASCII only (no high bytes), length check\n- string-utf8: UTF-8 length check (code points, not bytes)\n- list: Length must not exceed max-len\n- Add validation to TanStack Form field definitions using validators prop","acceptance_criteria":"- Principal fields reject invalid Stacks addresses\n- Trait reference fields require contract format (addr.contract)\n- Numeric fields enforce bit-width constraints\n- Buffer fields validate hex format and length\n- String fields enforce encoding and length limits\n- List fields enforce max length\n- Validation errors display clearly to user","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-17T06:56:03.851755-08:00","updated_at":"2025-12-17T06:56:03.851755-08:00"}
{"id":"clarigen-t3p","title":"Transaction Builder Feature","description":"Build a dynamic transaction builder for Stacks smart contracts.\n\nFeature allows users to:\n1. Navigate to /tx/:network/:contractAddress/:functionName\n2. See a dynamically generated form based on the contract's ABI\n3. Fill in function arguments with type-appropriate inputs\n4. Connect wallet and sign transactions (future)\n\nKey technical details:\n- Multi-network support (mainnet/testnet)\n- Form fields for all Clarity types (int, uint, bool, principal, buffers, strings, optionals, lists, tuples)\n- URL state persistence for shareable tx links\n- Integration with @stacks/connect for wallet connection\n\nPlanning doc: web/history/tx-builder-plan.md","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-16T17:56:38.377904-08:00","updated_at":"2025-12-16T17:58:36.751778-08:00"}
{"id":"clarigen-t3p.1","title":"Setup tx builder route with param validation","description":"Create TanStack Router route at /tx/$network.$contractAddress.$functionName.tsx\n\nRoute params:\n- network: 'mainnet' | 'testnet' (validate using constants.ts Network type)\n- contractAddress: Stacks contract ID like 'SP120SBRBQJ00MCWS7TM5R8WJNTTKD5K0HFRC2CNE.usdcx-v1'\n- functionName: Name of the function to call\n\nImplementation:\n1. Create file at web/src/routes/tx/$network.$contractAddress.$functionName.tsx\n2. Use createFileRoute with loader for server-side data fetching\n3. Validate network param, throw notFound() if invalid\n4. Parse and validate contractAddress format (should contain exactly one '.')\n5. Basic page scaffold that displays the params\n\nSee web/src/routes/__root.tsx and web/src/routes/index.tsx for existing patterns.\nTanStack Router docs: file-based routing with $param syntax.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T17:56:43.735675-08:00","updated_at":"2025-12-16T18:09:51.058566-08:00","closed_at":"2025-12-16T18:09:51.058566-08:00","close_reason":"Route created at `web/src/routes/tx.$network.$contractAddress.$functionName.tsx`. Validates network (mainnet/testnet), contract address format, and function existence in ABI. Fetches ABI in loader, displays function args. See `web/history/tx-builder-progress.md` for full details.","dependencies":[{"issue_id":"clarigen-t3p.1","depends_on_id":"clarigen-t3p","type":"parent-child","created_at":"2025-12-16T17:56:43.743803-08:00","created_by":"daemon"}]}
{"id":"clarigen-t3p.2","title":"Fetch contract ABI and function metadata","description":"Create TanStack Query hook to fetch contract ABI and extract function info.\n\nExisting infrastructure:\n- web/src/lib/stacks-api.ts has getContractAbi(network, contractId) already implemented\n- Returns ClarityAbi from @stacks/transactions (see packages/core/src/abi-types.ts for detailed types)\n\nImplementation:\n1. Create web/src/hooks/use-contract-abi.ts\n2. Export useContractAbi(network, contractId) hook using @tanstack/react-query\n3. Export useContractFunction(network, contractId, functionName) that:\n   - Uses useContractAbi internally\n   - Finds the function by name from abi.functions array\n   - Returns { function: ClarityAbiFunction | undefined, isLoading, error }\n4. Handle errors: contract not found, function not found\n5. Function has access type ('public' | 'read_only' | 'private') - filter to public/read_only\n\nClarityAbiFunction structure:\n{\n  name: string;\n  access: 'private' | 'public' | 'read_only';\n  args: Array\u003c{ name: string; type: ClarityAbiType }\u003e;\n  outputs: { type: ClarityAbiType };\n}","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T17:57:05.860765-08:00","updated_at":"2025-12-16T18:12:47.071098-08:00","closed_at":"2025-12-16T18:12:47.071098-08:00","close_reason":"Implemented TanStack Query hooks: useContractAbi, useContractFunction, useContractFunctions","dependencies":[{"issue_id":"clarigen-t3p.2","depends_on_id":"clarigen-t3p","type":"parent-child","created_at":"2025-12-16T17:57:05.864742-08:00","created_by":"daemon"}]}
{"id":"clarigen-t3p.3","title":"Build Clarity type form field components","description":"Create form input components for each Clarity type. This is the core of the tx builder.\n\nDirectory: web/src/components/tx-builder/fields/\n\nType → Component mapping:\n- uint128, int128 → NumberField (text input, validate numeric, convert to bigint)\n- bool → BoolField (use existing Switch component)\n- principal → PrincipalField (text input, validate Stacks address format SP.../ST...)\n- trait_reference → TraitField (text input, validate contract principal format addr.contract)\n- (buff N) → BufferField (hex input, use viem fromHex/toHex, validate byte length)\n- (string-ascii N) → StringAsciiField (text input, validate ASCII chars + max length)\n- (string-utf8 N) → StringUtf8Field (text input, validate max length)\n- (optional T) → OptionalField (toggle for none + recursive child field)\n- (list N T) → ListField (add/remove buttons + array of recursive child fields)\n- (tuple {...}) → TupleField (nested group of fields for each tuple member)\n\nCreate main dispatcher: web/src/components/tx-builder/clarity-field.tsx\n- Takes ClarityAbiType and renders appropriate field component\n- Recursive for nested types (optional, list, tuple)\n\nUse type checkers from packages/core/src/clarity-types.ts:\n- isClarityAbiPrimitive, isClarityAbiBuffer, isClarityAbiOptional, etc.\n\nFollow existing form component patterns in web/src/components/form-components.tsx.\nUse useFieldContext from @tanstack/react-form.\n\nFor buffers, install viem if not present: pnpm add viem -F web","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T17:57:18.222522-08:00","updated_at":"2025-12-16T19:07:02.83071-08:00","closed_at":"2025-12-16T19:07:02.83071-08:00","close_reason":"Implemented Clarity type form field components: ClarityField dispatcher + 10 field components (NumberField, BoolField, PrincipalField, BufferField, StringAsciiField, StringUtf8Field, OptionalField, ListField, TupleField). Integrated with tx route using TanStack Form.","dependencies":[{"issue_id":"clarigen-t3p.3","depends_on_id":"clarigen-t3p","type":"parent-child","created_at":"2025-12-16T17:57:18.227889-08:00","created_by":"daemon"}]}
{"id":"clarigen-t3p.4","title":"Create dynamic transaction form component","description":"Build the main transaction form that dynamically generates fields from function ABI.\n\nFile: web/src/components/tx-builder/tx-form.tsx\n\nImplementation:\n1. Accept props: { func: ClarityAbiFunction, contractId: string, network: NETWORK }\n2. Use useAppForm from web/src/hooks/form.ts with dynamic default values\n3. For each func.args, render a ClarityField component\n4. Generate default values object from args (empty strings, false for bool, etc.)\n5. On submit, use parseToCV from @clarigen/core to convert each value to ClarityValue\n6. For now, just console.log the converted values (actual tx comes later)\n\nForm value structure mirrors args:\n{ argName1: value1, argName2: value2, ... }\n\nFor nested types (tuple, list), values are nested accordingly:\n{ myTuple: { field1: 'value', field2: 123 }, myList: ['a', 'b'] }\n\nUse parseToCV(value, argType) from packages/core/src/clarity-types.ts to convert.\nHandle conversion errors gracefully with user feedback.\n\nIntegrate into the route component from task 1.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T17:57:44.805996-08:00","updated_at":"2025-12-17T06:20:24.483868-08:00","closed_at":"2025-12-17T06:20:24.483868-08:00","close_reason":"Form component already implemented - see TxBuilderForm in tx.$network.$contractAddress.$functionName.tsx","dependencies":[{"issue_id":"clarigen-t3p.4","depends_on_id":"clarigen-t3p","type":"parent-child","created_at":"2025-12-16T17:57:44.807999-08:00","created_by":"daemon"}]}
{"id":"clarigen-t3p.5","title":"Integrate Stacks wallet connection","description":"Add wallet connection using @stacks/connect.\n\nReference: https://docs.stacks.co/stacks-connect/connect-wallet\n\nInstallation: pnpm add @stacks/connect -F web\n\nImplementation:\n1. Create web/src/lib/stacks-wallet.ts with wallet configuration:\n   - AppConfig with ['store_write'] permission\n   - UserSession instance\n   - Helper functions: connectWallet(), disconnectWallet(), isConnected()\n\n2. Create web/src/hooks/use-stacks-wallet.ts:\n   - useStacksWallet() hook returning { address, isConnected, connect, disconnect }\n   - Persist session across page loads\n\n3. Create web/src/components/wallet-button.tsx:\n   - Shows 'Connect Wallet' when disconnected\n   - Shows truncated address + 'Disconnect' when connected\n   - Use existing Button component\n\n4. Add WalletButton to header or tx builder page\n\nshowConnect usage:\nimport { showConnect, AppConfig, UserSession } from '@stacks/connect';\n\nconst appConfig = new AppConfig(['store_write']);\nconst userSession = new UserSession({ appConfig });\n\nshowConnect({\n  appDetails: { name: 'Clarigen Tools', icon: '/favicon.ico' },\n  onFinish: () =\u003e { /* refresh state */ },\n  userSession,\n});\n\nGet address: userSession.loadUserData().profile.stxAddress.mainnet (or testnet)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T17:58:09.575639-08:00","updated_at":"2025-12-16T20:41:42.36046-08:00","closed_at":"2025-12-16T20:41:42.36046-08:00","close_reason":"Completed wallet auth integration with @stacks/connect","dependencies":[{"issue_id":"clarigen-t3p.5","depends_on_id":"clarigen-t3p","type":"parent-child","created_at":"2025-12-16T17:58:09.579754-08:00","created_by":"daemon"}]}
{"id":"clarigen-t3p.6","title":"Add URL state management with nuqs","description":"Persist form state in URL query params for shareability using nuqs.\n\nInstallation: pnpm add nuqs -F web\n\nGoal: Form values should sync to URL so users can share pre-filled tx links:\n/tx/mainnet/SP.../transfer?amount=1000\u0026recipient=SP...\n\nImplementation:\n1. Setup nuqs with TanStack Router (check nuqs docs for integration)\n2. Create custom hook: useUrlFormState(args: ClarityAbiArg[])\n   - Generates useQueryState calls for each argument\n   - Handles serialization/deserialization based on Clarity type\n3. Sync form state bidirectionally with URL params\n4. Handle complex types (tuples, lists) with JSON serialization\n\nSerialization strategy:\n- Primitives (uint, int, bool, strings): direct string representation\n- Buffers: hex string (no 0x prefix)\n- Optional: 'none' string or value\n- Lists/Tuples: JSON.stringify\n\nnuqs basic usage:\nimport { useQueryState, parseAsString, parseAsJson } from 'nuqs'\n\nconst [value, setValue] = useQueryState('key', parseAsString)\n\nConsider: nuqs may need adapter for TanStack Router - check docs.\nAlternative: use TanStack Router's built-in search params if nuqs integration is complex.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T17:58:25.592783-08:00","updated_at":"2025-12-17T06:27:54.119884-08:00","closed_at":"2025-12-17T06:27:54.119884-08:00","close_reason":"Implemented URL state management with nuqs - form values sync bidirectionally with URL query params","dependencies":[{"issue_id":"clarigen-t3p.6","depends_on_id":"clarigen-t3p","type":"parent-child","created_at":"2025-12-16T17:58:25.597039-08:00","created_by":"daemon"}]}
